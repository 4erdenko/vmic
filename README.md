# VMIC CLI

The `vmic` binary produces system reports from the registered collectors in this workspace.  Reports can be rendered in Markdown, JSON, and HTML, and the CLI exposes options to tune time ranges, thresholds, and output locations.

## Usage

```bash
vmic [OPTIONS]
```

If no options are provided the tool prints a Markdown report to stdout.

## Output control

| Option | Description |
| --- | --- |
| `--format <fmt>[,<fmt>...]` | One or more formats to generate. Accepted values: `markdown`, `json`, `html`. Defaults to `markdown`. Repeat the flag or provide a comma-separated list to emit multiple formats in one run. When multiple formats are requested, or when HTML is requested, the results are written to files. |
| `--output-dir <PATH>` | Directory where file outputs are stored. Defaults to the current working directory for formats that need files (`html` or multi-format runs). The directory is created if it does not exist. |

### Format behaviour

- **Markdown / JSON**
  - With a single format and no `--output-dir`, content is printed to stdout.
  - When multiple formats are requested or `--output-dir` is set, the artifact is saved as `vmic-report-<UTC timestamp>.md` / `.json` inside the output directory.
- **HTML**
  - Rendered as a human-friendly dashboard: key metrics appear as tables and bullet lists organised by section, the health digest sits at the top, and there is no raw JSON.
  - Always saved to `vmic-report-<UTC timestamp>.html` in the output directory (default: current directory).

Example:

```bash
vmic --format markdown,html --output-dir ./reports
```

Produces `reports/vmic-report-<timestamp>.md` and `.html`, and prints a confirmation for each file.

## Time filtering

| Option | Description |
| --- | --- |
| `--since <SINCE>` | Passes the value as `--since` to collectors that support it (currently the journald module). Accepts any string understood by `journalctl`, for example `"-2h"`, `"yesterday"`, or an RFC 3339 timestamp (`"2025-01-01T00:00:00Z"`). |

Example:

```bash
vmic --since "-6h" --format json
```

## Health digest thresholds

You can tune the global health digest without recompiling:

| Option | Default | Description |
| --- | --- | --- |
| `--digest-disk-warning <PERCENT>` | `90` | Warn when a mount exceeds this percentage of capacity. Accepts percentages (e.g. `85`) or ratios (e.g. `0.85`). |
| `--digest-disk-critical <PERCENT>` | `95` | Flag a mount as critical when usage meets or exceeds this percentage/ratio. |
| `--digest-memory-warning <PERCENT>` | `10` | Warn when available memory drops below this percentage of total. |
| `--digest-memory-critical <PERCENT>` | `5` | Flag available memory as critical below this percentage of total. |

The same thresholds can be set with environment variables prior to execution (CLI flags take precedence):

- `VMIC_DIGEST_DISK_WARNING`
- `VMIC_DIGEST_DISK_CRITICAL`
- `VMIC_DIGEST_MEMORY_WARNING`
- `VMIC_DIGEST_MEMORY_CRITICAL`

Values support either `0-100` (percent) or `0.0-1.0` (ratio) ranges.

Example:

```bash
VMIC_DIGEST_DISK_WARNING=80 VMIC_DIGEST_DISK_CRITICAL=90 \
  vmic --format markdown,json --output-dir ./reports
```

## Exit status

`vmic` returns a non-zero exit code if any collector fails catastrophically (for example when the binary cannot execute `journalctl`).

## Help

Use `vmic --help` to print the up-to-date usage generated by `clap`.
